"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[618],{3424:(t,e,o)=>{o.d(e,{CS:()=>d,Dd:()=>u,IL:()=>h,Iy:()=>w,Lc:()=>k,eh:()=>l,fk:()=>b,gp:()=>g,jd:()=>_,k5:()=>v,oX:()=>y,u7:()=>m,w3:()=>f});var n=o(5731);let a=[],s=[],c=null,i=null,r=0;function l(t){return t.replace(/\r\n/g,"\n").replace(/\r/g,"\n").replace(/\n\s*\n\s*\n+/g,"\n\n").trim()}function u(t){return t.replace(/^### (.*$)/gim,"<h3>$1</h3>").replace(/^## (.*$)/gim,"<h2>$1</h2>").replace(/^# (.*$)/gim,"<h1>$1</h1>").replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>").replace(/\*(.*?)\*/g,"<em>$1</em>").replace(/`(.*?)`/g,"<code>$1</code>").replace(/^- (.*$)/gim,"<li>$1</li>").replace(/^---$/gim,"<hr>").replace(/\n/g,"<br>")}async function d(){try{let t=Date.now();if(c&&t-r<3e4)return c;let e=await fetch("".concat(n.Py,"/api/user_quiz_and_notes/"),{method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(localStorage.getItem("token")||"")}});if(!e.ok)return[];let o=await e.json(),a=Array.isArray(null==o?void 0:o.favorite_quiz_topics)?o.favorite_quiz_topics:[],s=new Map(a.map(t=>[Number(null==t?void 0:t.id),String((null==t?void 0:t.quiz_topic)||"").trim()])),i=Array.isArray(null==o?void 0:o.favorite_notes)?o.favorite_notes.map(t=>{var e;let o=null!=(e=null==t?void 0:t.title)?e:"",n=String((null==t?void 0:t.content)||"").split("\n")[0],a=String(o).trim()||n||"未命名筆記",c="";if("string"==typeof(null==t?void 0:t.content))try{c=JSON.parse(t.content.replace(/'/g,'"')).explanation_text||t.content}catch(e){c=t.content}else"object"==typeof(null==t?void 0:t.content)&&(null==t?void 0:t.content)!==null&&(c=t.content.explanation_text||"");let i=null==t?void 0:t.quiz_topic_id,r=s.get(Number(i))||"";return{id:Number(null==t?void 0:t.id),title:a,content:c,subject:r,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()}}):[];return c=i,r=t,i}catch(t){return[]}}async function m(){try{let t=Date.now();if(i&&t-r<3e4)return i;let e=await fetch("".concat(n.Py,"/api/user_quiz_and_notes/"),{method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(localStorage.getItem("token")||"")}});if(!e.ok)return[];let o=await e.json(),a=Array.isArray(null==o?void 0:o.favorite_quiz_topics)?o.favorite_quiz_topics.map(t=>null==t?void 0:t.quiz_topic).filter(Boolean):[];return i=a,a}catch(t){return[]}}async function p(){try{let t=Date.now();if(i&&t-r<3e4&&C&&C.size>0){let t=[];return C.forEach((e,o)=>{t.push({id:e,name:o})}),t}let e=await fetch("".concat(n.Py,"/api/user_quiz_and_notes/"),{method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(localStorage.getItem("token")||"")}});if(!e.ok)return[];let o=await e.json();return Array.isArray(null==o?void 0:o.favorite_quiz_topics)?o.favorite_quiz_topics.map(t=>({id:null==t?void 0:t.id,name:null==t?void 0:t.quiz_topic})).filter(t=>t.id&&t.name):[]}catch(t){return[]}}function h(){c=null,i=null,r=0,C.clear()}async function g(t){try{await m();let e=await fetch("".concat(n.Py,"/api/user_quiz_and_notes/"),{method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(localStorage.getItem("token")||"")}});if(!e.ok)return await e.text(),{success:!1,message:"獲取主題數據失敗"};let o=await e.json(),a=(Array.isArray(null==o?void 0:o.favorite_quiz_topics)?o.favorite_quiz_topics:[]).find(e=>(null==e?void 0:e.quiz_topic)===t.subject);if(!a)return{success:!1,message:"找不到主題「".concat(t.subject,"」")};let s={title:t.title,quiz_topic:a.id,content:t.content},c=await fetch("".concat(n.Py,"/api/notes/"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(localStorage.getItem("token")||"")},body:JSON.stringify(s)});if(!c.ok)return await c.text(),{success:!1,message:"新增筆記失敗：".concat(c.status)};let i=await c.json();return h(),{success:!0,message:"筆記添加成功！",data:i}}catch(t){return{success:!1,message:"保存失敗，請重試！"}}}async function w(t){try{let e=await fetch("".concat(n.Py,"/api/notes/").concat(t,"/"),{method:"DELETE",headers:{Authorization:"Bearer ".concat(localStorage.getItem("token")||"")}});if(!e.ok)return await e.text(),{success:!1,message:"刪除筆記失敗：".concat(e.status)};return h(),{success:!0,message:"筆記已刪除！"}}catch(t){return{success:!1,message:"刪除失敗，請重試！"}}}async function f(t,e){try{let o={title:e.title,content:e.content},a=await fetch("".concat(n.Py,"/api/notes/").concat(t,"/"),{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(localStorage.getItem("token")||"")},body:JSON.stringify(o)});if(!a.ok)return await a.text(),{success:!1,message:"編輯筆記失敗：".concat(a.status)};let s=await a.json();return h(),{success:!0,message:"筆記更新成功！",data:s}}catch(t){return{success:!1,message:"編輯失敗，請重試！"}}}async function v(t,e){try{let o=(await p()).find(t=>t.name===e);if(!o)return{success:!1,message:"找不到主題「".concat(e,"」")};let a={quiz_topic_id:o.id},s=await fetch("".concat(n.Py,"/api/notes/").concat(t,"/"),{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(localStorage.getItem("token")||"")},body:JSON.stringify(a)});if(!s.ok)return await s.text(),{success:!1,message:"搬移筆記失敗：".concat(s.status)};let c=await s.json();return h(),{success:!0,message:"筆記搬移成功！",data:c}}catch(t){return{success:!1,message:"搬移失敗，請重試！"}}}async function y(t){try{let e=await fetch("".concat(n.Py,"/api/create_quiz/"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(localStorage.getItem("token")||"")},body:JSON.stringify({quiz_topic:t})});if(!e.ok)return await e.text(),{success:!1,message:"新增主題失敗：".concat(e.status)};let o=await e.json();return h(),{success:!0,message:"主題新增成功！",data:o}}catch(t){return{success:!1,message:"新增失敗，請重試！"}}}let C=new Map;async function b(t){try{let e=C.get(t);if(!e){let o=await fetch("".concat(n.Py,"/api/user_quiz_and_notes/"),{method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(localStorage.getItem("token")||"")}});if(!o.ok)return{success:!1,message:"獲取主題信息失敗：".concat(o.status)};let a=await o.json();if((Array.isArray(null==a?void 0:a.favorite_quiz_topics)?a.favorite_quiz_topics:[]).forEach(t=>{(null==t?void 0:t.quiz_topic)&&(null==t?void 0:t.id)&&C.set(t.quiz_topic,t.id)}),!(e=C.get(t)))return{success:!1,message:"找不到主題「".concat(t,"」")}}let o=await fetch("".concat(n.Py,"/api/quiz/").concat(e,"/soft-delete/"),{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(localStorage.getItem("token")||"")}});if(!o.ok)return await o.text(),{success:!1,message:"刪除主題失敗：".concat(o.status)};let a=await o.json();if(a.message&&a.message.includes("restored"))return{success:!1,message:"後端操作失敗：主題被恢復而不是刪除"};if(a.message&&!a.message.includes("deleted")&&!a.message.includes("soft deleted"))return{success:!1,message:"後端操作失敗：操作類型不正確"};return C.delete(t),h(),{success:!0,message:"主題刪除成功！"}}catch(t){return{success:!1,message:"刪除失敗，請重試！"}}}async function _(){try{let t=await fetch("".concat(n.Py,"/api/user_quiz_and_notes/"),{method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(localStorage.getItem("token")||"")}});if(!t.ok)return await t.text().catch(()=>""),{success:!1,message:"載入失敗（".concat(t.status,"）")};let e=await t.json(),o=Array.isArray(null==e?void 0:e.favorite_quiz_topics)?e.favorite_quiz_topics:[],l=new Map(o.map(t=>[Number(null==t?void 0:t.id),String((null==t?void 0:t.quiz_topic)||"").trim()]));return o.forEach(t=>{(null==t?void 0:t.quiz_topic)&&(null==t?void 0:t.id)&&C.set(t.quiz_topic,t.id)}),s=[...l.values()].filter(Boolean),c=a=(Array.isArray(null==e?void 0:e.favorite_notes)?e.favorite_notes:[]).map(t=>{var e;let o=null!=(e=null==t?void 0:t.title)?e:"",n=String((null==t?void 0:t.content)||"").split("\n")[0],a=String(o).trim()||n||"未命名筆記",s="";if("string"==typeof(null==t?void 0:t.content))try{s=JSON.parse(t.content.replace(/'/g,'"')).explanation_text||t.content}catch(e){s=t.content}else"object"==typeof(null==t?void 0:t.content)&&(null==t?void 0:t.content)!==null&&(s=t.content.explanation_text||"");let c=l.get(Number(null==t?void 0:t.quiz_topic_id))||"";return{id:Number(null==t?void 0:t.id)||Date.now()+Math.random(),title:a,content:s,subject:c,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()}}),i=s,r=Date.now(),{success:!0,message:"載入完成",subjectsCount:s.length,notesCount:a.length}}catch(t){return{success:!1,message:"載入失敗"}}}async function k(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";try{let o=localStorage.getItem("token");if(!o)return{success:!1,message:"請先登入！"};if(!t||"string"!=typeof t||0===t.trim().length)return{success:!1,message:"筆記內容無效或為空！"};let a=await fetch("".concat(n.Py,"/api/generate_topic_from_note"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(o)},body:JSON.stringify({note_content:t.trim(),note_title:e.trim()})});if(!a.ok)return await a.text(),{success:!1,message:"AI生成失敗：".concat(a.status)};let s=await a.json();return{success:!0,topic:s.topic,message:"主題生成成功！"}}catch(t){return{success:!1,message:"生成失敗，請稍後再試！"}}}},4247:(t,e,o)=>{o.r(e),o.d(e,{closeCustomConfirm:()=>a,safeConfirm:()=>s,showCustomConfirm:()=>n});let n=(t,e,o)=>{let n=document.createElement("div");n.className="custom-confirm-modal",n.innerHTML='\n        <div class="custom-confirm-content">\n            <div class="custom-confirm-message">'.concat(t,'</div>\n            <div class="custom-confirm-buttons">\n                <button class="custom-confirm-btn custom-confirm-cancel" onclick="closeCustomConfirm(false)">取消</button>\n                <button class="custom-confirm-btn custom-confirm-ok" onclick="closeCustomConfirm(true)">確定</button>\n            </div>\n        </div>\n    '),document.body.appendChild(n),window.customConfirmCallbacks={onConfirm:e,onCancel:o},document.body.style.overflow="hidden",setTimeout(()=>{n.classList.add("active")},10)},a=t=>{let e=document.querySelector(".custom-confirm-modal");e&&(e.classList.remove("active"),setTimeout(()=>{document.body.removeChild(e),document.body.style.overflow="auto",window.customConfirmCallbacks&&(t&&window.customConfirmCallbacks.onConfirm?window.customConfirmCallbacks.onConfirm():!t&&window.customConfirmCallbacks.onCancel&&window.customConfirmCallbacks.onCancel(),window.customConfirmCallbacks=null)},300))},s=(t,e,o)=>{n(t,e,o)}},4740:(t,e,o)=>{o.r(e),o.d(e,{closePasswordChangeDialog:()=>a,confirmPasswordChange:()=>s,showPasswordChangeDialog:()=>n});let n=t=>{let e=document.createElement("div");e.className="custom-prompt-modal",e.innerHTML='\n        <div class="custom-prompt-content">\n            <div class="custom-prompt-title">更改密碼</div>\n            <div class="password-input-group">\n                <label for="oldPasswordInput">舊密碼：</label>\n                <input type="password" class="custom-prompt-input" id="oldPasswordInput" placeholder="請輸入舊密碼">\n            </div>\n            <div class="password-input-group">\n                <label for="newPasswordInput">新密碼：</label>\n                <input type="password" class="custom-prompt-input" id="newPasswordInput" placeholder="請輸入新密碼">\n            </div>\n            <div class="custom-prompt-buttons">\n                <button class="custom-prompt-btn custom-prompt-btn-secondary" onclick="closePasswordChangeDialog()">取消</button>\n                <button class="custom-prompt-btn custom-prompt-btn-primary" onclick="confirmPasswordChange()">確定</button>\n            </div>\n        </div>\n    ',document.body.appendChild(e),window.passwordChangeCallback=t,document.body.style.overflow="hidden",setTimeout(()=>{e.classList.add("active");let t=document.getElementById("oldPasswordInput");t&&t.focus()},10)},a=()=>{let t=document.querySelector(".custom-prompt-modal");t&&(t.classList.remove("active"),setTimeout(()=>{document.body.removeChild(t),document.body.style.overflow="auto",window.passwordChangeCallback&&(window.passwordChangeCallback(null,null),window.passwordChangeCallback=null)},300))},s=()=>{let t=document.getElementById("oldPasswordInput"),e=document.getElementById("newPasswordInput"),o=t?t.value.trim():"",n=e?e.value.trim():"",a=document.querySelector(".custom-prompt-modal");a&&(a.classList.remove("active"),setTimeout(()=>{document.body.removeChild(a),document.body.style.overflow="auto",window.passwordChangeCallback&&(window.passwordChangeCallback(o,n),window.passwordChangeCallback=null)},300))}},5445:(t,e,o)=>{o.r(e),o.d(e,{closeCustomAlert:()=>a,safeAlert:()=>s,showCustomAlert:()=>n});let n=(t,e)=>{let o=document.createElement("div");o.className="custom-alert-modal",o.innerHTML='\n        <div class="custom-alert-content">\n            <div class="custom-alert-message">'.concat(t,'</div>\n            <button class="custom-alert-btn" onclick="closeCustomAlert()">確定</button>\n        </div>\n    '),document.body.appendChild(o),window.customAlertCallback=e,document.body.style.overflow="hidden",setTimeout(()=>{o.classList.add("active")},10)},a=()=>{let t=document.querySelector(".custom-alert-modal");t&&(t.classList.remove("active"),setTimeout(()=>{document.body.removeChild(t),document.body.style.overflow="auto",window.customAlertCallback&&(window.customAlertCallback(),window.customAlertCallback=null)},300))},s=(t,e)=>{n(t,e)}},5731:(t,e,o)=>{o.d(e,{Py:()=>s});var n=o(3464);let a=o(9509).env.NEXT_PUBLIC_API_ORIGIN||"/api",s="".concat(a),c=n.A.create({baseURL:s,withCredentials:!0}),i=async function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=t.startsWith("/")?"".concat(s).concat(t):"".concat(s,"/").concat(t),n=await fetch(o,{...e,credentials:"include"});if(!n.ok)throw Error("API Error: ".concat(n.status));return n.json()};try{i[Symbol.toPrimitive]=()=>s,i.toString=()=>s,i.valueOf=()=>s}catch(t){}try{c[Symbol.toPrimitive]=()=>s,c.toString=()=>s,c.valueOf=()=>s}catch(t){}},6153:(t,e,o)=>{o.d(e,{A:()=>i});var n=o(5155),a=o(6874),s=o.n(a),c=o(6766);function i(t){let{showMenu:e=!1,isMenuOpen:o=!1,onToggleMenu:a=null,showAuthNav:i=!1,enableNoteQLink:r=!1}=t;return(0,n.jsx)("section",{id:"header",children:(0,n.jsx)("header",{className:"site-header",children:(0,n.jsxs)("div",{className:"container header-container",children:[r?(0,n.jsx)(s(),{href:"/homegame",className:"brand-name",style:{textDecoration:"none",color:"inherit"},children:"NoteQ"}):(0,n.jsx)("div",{className:"brand-name",children:"NoteQ"}),i&&(0,n.jsxs)("nav",{className:"auth-nav",children:[(0,n.jsx)(s(),{href:"/login?signup=1",className:"btn-signup",children:"Sign up"}),(0,n.jsx)(s(),{href:"/login",className:"btn-login",children:"Login"})]}),e&&(0,n.jsx)("button",{className:"menu-button ".concat(o?"active":""),"aria-label":"Toggle menu",onClick:a,children:(0,n.jsx)(c.default,{src:"/img/Vector-18.png",alt:"Menu Icon",width:24,height:24})})]})})})}},6349:(t,e,o)=>{o.d(e,{I:()=>a});var n=o(9057);let a=()=>{(0,n.gB)("確定要登出嗎？",()=>{localStorage.clear(),sessionStorage.clear(),window.location.href="/"},()=>{})}},7771:(t,e,o)=>{o.d(e,{A:()=>l});var n=o(5155),a=o(6874),s=o.n(a),c=o(6766),i=o(5695),r=o(6349);function l(t){let{isOpen:e=!1,onClose:o=null}=t,a=(0,i.usePathname)();return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:"menu-backdrop ".concat(e?"active":""),onClick:o}),(0,n.jsxs)("div",{className:"menu-dropdown ".concat(e?"active":""),children:[(0,n.jsx)("div",{className:"menu-header"}),[{href:"/homegame",icon:"/img/Vector-16.png",label:"首頁"},{href:"/note",icon:"/img/Vector-15.png",label:"筆記"},{href:"/user",icon:"/img/Vector-33.png",label:"使用者"}].map(t=>(0,n.jsxs)(s(),{href:t.href,className:"menu-item ".concat(a===t.href?"active":""),children:[(0,n.jsx)(c.default,{src:t.icon,alt:"",className:"menu-item-icon",width:24,height:24}),(0,n.jsx)("span",{children:t.label})]},t.href)),(0,n.jsxs)("button",{className:"menu-item logout-button",onClick:r.I,style:{background:"none",border:"none",cursor:"pointer"},children:[(0,n.jsx)(c.default,{src:"/img/Vector-30.png",alt:"",className:"menu-item-icon",width:24,height:24}),(0,n.jsx)("span",{children:"登出"})]})]})]})}},9057:(t,e,o)=>{o.d(e,{S5:()=>n.safeAlert,gB:()=>a.safeConfirm,bF:()=>s.showPasswordChangeDialog});var n=o(5445),a=o(4247),s=o(4740);Promise.resolve().then(o.bind(o,5445)).then(t=>{window.showCustomAlert=t.showCustomAlert,window.closeCustomAlert=t.closeCustomAlert,window.safeAlert=t.safeAlert}),Promise.resolve().then(o.bind(o,4247)).then(t=>{window.showCustomConfirm=t.showCustomConfirm,window.closeCustomConfirm=t.closeCustomConfirm,window.safeConfirm=t.safeConfirm}),o.e(11).then(o.bind(o,11)).then(t=>{window.showCustomPrompt=t.showCustomPrompt,window.closeCustomPrompt=t.closeCustomPrompt,window.confirmCustomPrompt=t.confirmCustomPrompt}),Promise.resolve().then(o.bind(o,4740)).then(t=>{window.showPasswordChangeDialog=t.showPasswordChangeDialog,window.closePasswordChangeDialog=t.closePasswordChangeDialog,window.confirmPasswordChange=t.confirmPasswordChange})}}]);