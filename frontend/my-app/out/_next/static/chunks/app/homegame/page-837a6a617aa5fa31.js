(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[90],{1684:(e,t,r)=>{Promise.resolve().then(r.bind(r,8460))},5654:e=>{e.exports={gameSelectSection:"HomeGamePage_gameSelectSection__vWpUJ",pageContainer:"HomeGamePage_pageContainer__lhRi5",difficultyHub:"HomeGamePage_difficultyHub__P6tE1",hubOutline:"HomeGamePage_hubOutline___fEj1",hubTitle:"HomeGamePage_hubTitle__xzN27",difficultyButton:"HomeGamePage_difficultyButton__jMoDi",selected:"HomeGamePage_selected__kT3L4",difficultyTest:"HomeGamePage_difficultyTest__kxb_M",difficultyMaster:"HomeGamePage_difficultyMaster__ygveb",difficultyBeginner:"HomeGamePage_difficultyBeginner___X_2F",difficultyIntermediate:"HomeGamePage_difficultyIntermediate__TrMzG",difficultyAdvanced:"HomeGamePage_difficultyAdvanced__zAUPJ",topicInput:"HomeGamePage_topicInput__IeNBZ",challengeStartForm:"HomeGamePage_challengeStartForm__xhJY2",questionCountInput:"HomeGamePage_questionCountInput__QgZVe",startButton:"HomeGamePage_startButton__JmePZ",decryptionOverlay:"HomeGamePage_decryptionOverlay__OKZQR",decryptionContainer:"HomeGamePage_decryptionContainer__PLIcX",decryptionText:"HomeGamePage_decryptionText__iZ_mL"}},6635:e=>{e.exports={"target-cursor-wrapper":"TargetCursor_target-cursor-wrapper__wbnv8","target-cursor-dot":"TargetCursor_target-cursor-dot___k403","target-cursor-corner":"TargetCursor_target-cursor-corner__6Nz_v","corner-tl":"TargetCursor_corner-tl__7EHtv","corner-tr":"TargetCursor_corner-tr__nU1zF","corner-br":"TargetCursor_corner-br__AoxCr","corner-bl":"TargetCursor_corner-bl__7Q2kd"}},8460:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>h});var n=r(5155),o=r(5731),a=r(5695),i=r(2115),s=r(6766);r(6874);var c=r(5654),u=r.n(c),l=r(9057),d=r(6153),m=r(6349),g=r(7771),p=r(1283),f=r(802),_=r(6635),y=r.n(_);let v=e=>{let{targetSelector:t=".cursor-target",spinDuration:r=2,hideDefaultCursor:o=!0}=e,a=(0,i.useRef)(null),s=(0,i.useRef)(null),c=(0,i.useRef)(null),u=(0,i.useRef)(null),[l,d]=(0,i.useState)(window.innerWidth),m=(0,i.useMemo)(()=>/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)||l<=768,[l]),[g,p]=(0,i.useState)(!1);(0,i.useEffect)(()=>{let e=()=>{p(document.querySelectorAll('[class*="decryption"]').length>0)};e();let t=setInterval(e,100);return()=>clearInterval(t)},[]),(0,i.useEffect)(()=>{let e=()=>{d(window.innerWidth)};return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]);let _=(0,i.useMemo)(()=>({borderWidth:3,cornerSize:12,parallaxStrength:5e-5}),[]),v=(0,i.useCallback)((e,t)=>{a.current&&f.os.to(a.current,{x:e,y:t,duration:.1,ease:"power3.out"})},[]);return((0,i.useEffect)(()=>{if(!a.current)return;let e=document.body.style.cursor;o&&(document.body.style.cursor="none");let n=a.current;s.current=n.querySelectorAll(".".concat(y()["target-cursor-corner"]));let i=null,l=null,d=null,m=!1,g=null,p=e=>{l&&e.removeEventListener("mousemove",l),d&&e.removeEventListener("mouseleave",d),l=null,d=null};f.os.set(n,{xPercent:-50,yPercent:-50,x:window.innerWidth/2,y:window.innerHeight/2}),c.current&&c.current.kill(),c.current=f.os.timeline({repeat:-1}).to(n,{rotation:"+=360",duration:r,ease:"none"});let h=e=>v(e.clientX,e.clientY);window.addEventListener("mousemove",h);let w=()=>{if(!i||!a.current)return;let e=f.os.getProperty(a.current,"x"),r=f.os.getProperty(a.current,"y"),n=document.elementFromPoint(e,r);!(n&&(n===i||n.closest(t)===i))&&d&&d()};window.addEventListener("scroll",w,{passive:!0}),window.addEventListener("mousemove",h),window.addEventListener("mousedown",()=>{u.current&&(f.os.to(u.current,{scale:.7,duration:.3}),f.os.to(a.current,{scale:.9,duration:.2}))}),window.addEventListener("mouseup",()=>{u.current&&(f.os.to(u.current,{scale:1,duration:.3}),f.os.to(a.current,{scale:1,duration:.2}))});let x=e=>{var n;let o=e.target,u=[],y=o;for(;y&&y!==document.body;)y.matches(t)&&u.push(y),y=y.parentElement;let v=u[0]||null;if(!v||!a.current||!s.current||i===v)return;i&&p(i),g&&(clearTimeout(g),g=null),i=v,f.os.killTweensOf(a.current,"rotation"),null==(n=c.current)||n.pause(),f.os.set(a.current,{rotation:0});let h=(e,t)=>{let r=v.getBoundingClientRect(),n=a.current.getBoundingClientRect(),o=n.left+n.width/2,i=n.top+n.height/2,[c,u,l,d]=Array.from(s.current),{borderWidth:m,cornerSize:g,parallaxStrength:p}=_,y={x:r.left-o-m,y:r.top-i-m},h={x:r.right-o+m-g,y:r.top-i-m},w={x:r.right-o+m-g,y:r.bottom-i+m-g},x={x:r.left-o-m,y:r.bottom-i+m-g};if(void 0!==e&&void 0!==t){let n=r.left+r.width/2,o=r.top+r.height/2,a=(e-n)*p,i=(t-o)*p;y.x+=a,y.y+=i,h.x+=a,h.y+=i,w.x+=a,w.y+=i,x.x+=a,x.y+=i}let S=f.os.timeline(),E=[y,h,w,x];[c,u,l,d].forEach((e,t)=>{S.to(e,{x:E[t].x,y:E[t].y,duration:.2,ease:"power2.out"},0)})};m=!0,h(),setTimeout(()=>{m=!1},1);let w=null,x=e=>{w||m||(w=requestAnimationFrame(()=>{h(e.clientX,e.clientY),w=null}))},S=()=>{if(i=null,m=!1,s.current){let e=Array.from(s.current);f.os.killTweensOf(e);let{cornerSize:t}=_,r=[{x:-(1.5*t),y:-(1.5*t)},{x:.5*t,y:-(1.5*t)},{x:.5*t,y:.5*t},{x:-(1.5*t),y:.5*t}],n=f.os.timeline();e.forEach((e,t)=>{n.to(e,{x:r[t].x,y:r[t].y,duration:.3,ease:"power3.out"},0)})}g=setTimeout(()=>{if(!i&&a.current&&c.current){let e=f.os.getProperty(a.current,"rotation")%360;c.current.kill(),c.current=f.os.timeline({repeat:-1}).to(a.current,{rotation:"+=360",duration:r,ease:"none"}),f.os.to(a.current,{rotation:e+360,duration:r*(1-e/360),ease:"none",onComplete:()=>{var e;null==(e=c.current)||e.restart()}})}g=null},50),p(v)};l=x,d=S,v.addEventListener("mousemove",x),v.addEventListener("mouseleave",S)};return window.addEventListener("mouseover",x,{passive:!0}),()=>{var t;window.removeEventListener("mousemove",h),window.removeEventListener("mouseover",x),window.removeEventListener("scroll",w),i&&p(i),null==(t=c.current)||t.kill(),document.body.style.cursor=e}},[t,r,v,_,o]),(0,i.useEffect)(()=>{a.current&&c.current&&c.current.isActive()&&(c.current.kill(),c.current=f.os.timeline({repeat:-1}).to(a.current,{rotation:"+=360",duration:r,ease:"none"}))},[r]),m||g)?null:(0,n.jsxs)("div",{ref:a,className:y()["target-cursor-wrapper"],children:[(0,n.jsx)("div",{ref:u,className:y()["target-cursor-dot"]}),(0,n.jsx)("div",{className:"".concat(y()["target-cursor-corner"]," ").concat(y()["corner-tl"])}),(0,n.jsx)("div",{className:"".concat(y()["target-cursor-corner"]," ").concat(y()["corner-tr"])}),(0,n.jsx)("div",{className:"".concat(y()["target-cursor-corner"]," ").concat(y()["corner-br"])}),(0,n.jsx)("div",{className:"".concat(y()["target-cursor-corner"]," ").concat(y()["corner-bl"])})]})};function h(){let[e,t]=(0,i.useState)(null),[r,c]=(0,i.useState)(""),[f,_]=(0,i.useState)("例：19世紀歐洲歷史"),[y,h]=(0,i.useState)(""),[w,x]=(0,i.useState)(!1),[S,E]=(0,i.useState)(!1),[b,N]=(0,i.useState)(0),[T,P]=(0,i.useState)(!1),C=(0,a.useRouter)();(0,i.useEffect)(()=>{let e=sessionStorage.getItem("generatedTopic"),r=sessionStorage.getItem("generatedTopicSource");e&&"note"===r&&(c(e),sessionStorage.removeItem("generatedTopic"),sessionStorage.removeItem("generatedTopicSource"),sessionStorage.removeItem("generatedTopicNoteId"),t("intermediate"),h("5"))},[]);let j=()=>{x(!1),document.body.style.overflow="auto"},I=async()=>{if(!e)return void(0,l.S5)("請選擇難度");if(!r.trim())return void(0,l.S5)("請輸入主題");let t=parseInt(y,10);return!t||t<1||t>15?void(0,l.S5)("請輸入有效的題數（1~15 題）"):localStorage.getItem("token")?void(E(!0),P(!0),N(0),k()):void(0,l.S5)("請先登入再開始挑戰")},k=async()=>{try{let t=localStorage.getItem("token"),n=r.trim(),a=null;try{let e=await fetch("".concat(o.Py,"/api/create_quiz/"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(t)},body:JSON.stringify({quiz_topic:n})});if(e.ok){if(a=(await e.json()).quiz_topic_id,window.dispatchEvent){let e=new CustomEvent("topicCreated",{detail:{topic:n,id:a}});window.dispatchEvent(e)}}else if(400===e.status){let e=await fetch("".concat(o.Py,"/api/user_quiz_and_notes/"),{method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(t)}});if(e.ok){let t=await e.json(),r=(Array.isArray(null==t?void 0:t.favorite_quiz_topics)?t.favorite_quiz_topics:[]).find(e=>(null==e?void 0:e.quiz_topic)===n);r&&(a=r.id)}}}catch(e){console.warn("創建Quiz主題時出錯:",e)}let i=await fetch("".concat(o.Py,"/api/quiz/"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(t)},body:JSON.stringify({user_id:localStorage.getItem("userId"),topic:n,difficulty:e,question_count:parseInt(y,10)})}),s=await i.json();sessionStorage.setItem("quizData",JSON.stringify({quiz:s.quiz,topics:s.topics||[],question_count:parseInt(y,10),created_topic:n,topic_id:a})),N(4),setTimeout(()=>{E(!1),P(!1),C.push("/game")},1500)}catch(e){(0,l.S5)("題目發送失敗，請稍後再試"),E(!1),P(!1)}};return(0,i.useEffect)(()=>{let e=e=>{"Escape"===e.key&&j()};return document.addEventListener("keydown",e),()=>{document.removeEventListener("keydown",e)}},[]),(0,i.useEffect)(()=>{let e=e=>{let t=e.target;("BUTTON"===t.tagName||"INPUT"===t.tagName||"TEXTAREA"===t.tagName||"SELECT"===t.tagName||t.closest(".custom-select")||t.closest(".menu-button")||t.closest(".action-item"))&&e.touches.length>1&&e.preventDefault()};return document.addEventListener("touchstart",e,{passive:!1}),()=>{document.removeEventListener("touchstart",e)}},[]),(0,n.jsxs)(n.Fragment,{children:[!w&&(0,n.jsx)(v,{spinDuration:2,hideDefaultCursor:!0}),(0,n.jsx)(d.A,{showMenu:!0,isMenuOpen:w,onToggleMenu:()=>{x(!w),w?document.body.style.overflow="auto":document.body.style.overflow="hidden"},enableNoteQLink:!0}),(0,n.jsx)("main",{id:"game-select",className:u().gameSelectSection,children:(0,n.jsxs)("div",{className:u().pageContainer,children:[(0,n.jsx)("input",{type:"text",className:"".concat(u().topicInput," cursor-target"),placeholder:f,value:r,onChange:e=>c(e.target.value),onFocus:()=>_(""),onBlur:()=>{r.trim()||_("例：19世紀歐洲歷史")}}),(0,n.jsxs)("div",{className:u().difficultyHub,children:[(0,n.jsx)(s.default,{src:"/img/Vector-19.png",alt:"Hub outline",className:u().hubOutline,width:600,height:500,priority:!0}),(0,n.jsx)("h2",{className:u().hubTitle,children:"難度選擇"}),[{id:"test",name:"測驗",icon:"/img/Vector-5.png",className:"difficultyTest"},{id:"master",name:"大師",icon:"/img/Vector-4.png",className:"difficultyMaster"},{id:"beginner",name:"初級",icon:"/img/Vector.png",className:"difficultyBeginner"},{id:"intermediate",name:"中級",icon:"/img/Vector-2.png",className:"difficultyIntermediate"},{id:"advanced",name:"高級",icon:"/img/Vector-3.png",className:"difficultyAdvanced"}].map(r=>(0,n.jsxs)("button",{className:"".concat(u().difficultyButton," ").concat(u()[r.className]," ").concat(e===r.id?u().selected:""," cursor-target"),onClick:()=>{t(r.id)},children:[(0,n.jsx)(s.default,{src:r.icon,alt:r.name,width:24,height:24}),(0,n.jsx)("span",{children:r.name})]},r.id))]}),(0,n.jsxs)("div",{className:u().challengeStartForm,children:[(0,n.jsx)("input",{type:"number",className:"".concat(u().questionCountInput," cursor-target"),placeholder:"輸入題數",min:"1",max:"50",value:y,onChange:e=>h(e.target.value)}),(0,n.jsxs)("button",{className:"".concat(u().startButton," cursor-target"),onClick:I,children:[(0,n.jsx)("span",{children:"開始挑戰\xa0"}),(0,n.jsx)(s.default,{src:"/img/Vector-12.png",alt:"Arrow right",width:12,height:12})]})]})]})}),S&&(0,n.jsx)("div",{className:u().decryptionOverlay,children:(0,n.jsx)("div",{className:u().decryptionContainer,children:(0,n.jsx)(p.A,{text:0===b?"正在初始化題目生成系統...":1===b?"正在分析難度等級和主題內容...":2===b?"正在生成個性化題目，請稍候...":3===b?"正在優化題目內容...":4===b?"題目生成完成！準備開始...":"",onComplete:()=>{T&&b<3?N(e=>e+1):T&&3===b&&N(0)},speed:80,className:u().decryptionText},"decryption-text")})}),(0,n.jsx)(g.A,{isOpen:w,onClose:j,onLogout:m.I})]})}}},e=>{e.O(0,[845,272,592,794,259,802,791,441,964,358],()=>e(e.s=1684)),_N_E=e.O()}]);