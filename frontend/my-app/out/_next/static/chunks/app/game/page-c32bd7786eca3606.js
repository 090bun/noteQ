(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[925],{1857:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>_});var n=a(5155),s=a(5731),o=a(2115),i=a(6766),r=a(3457),l=a.n(r),c=a(6153),u=a(7771),d=a(1283),m=a(6349);let _=()=>{var e,t,a,r,_;let[p,g]=(0,o.useState)(1),[h,x]=(0,o.useState)(null),[y,v]=(0,o.useState)(!1),[N,w]=(0,o.useState)(1),[S,j]=(0,o.useState)(null),[C,G]=(0,o.useState)([]),[P,f]=(0,o.useState)([]),[b,k]=(0,o.useState)(!1),[B,O]=(0,o.useState)(!1),[T,q]=(0,o.useState)(!1),[A,I]=(0,o.useState)(!1),[E,D]=(0,o.useState)(0),[M,z]=(0,o.useState)(!1);(0,o.useEffect)(()=>{let e=sessionStorage.getItem("quizData");if(e)try{let t=JSON.parse(e);j(t.quiz||{}),G(t.topics||[]),w(t.question_count||1)}catch(e){console.error("解析 quizData 失敗：",e)}else window.location.href="/"},[]);let F=async()=>{T||(q(!0),I(!0),z(!0),D(0),J())},J=async()=>{try{let e={updates:P.map(e=>{let{topicId:t,selected:a}=e;return{id:t,user_answer:a}})},t=localStorage.getItem("token"),a=await fetch("".concat(s.Py,"/api/submit_answer/"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(t)},body:JSON.stringify(e)});a.ok||console.error("提交答案失敗：",a.status,await a.text());let n=(await a.json()).familiarity||0;sessionStorage.setItem("familiarity",n),D(4),setTimeout(()=>{I(!1),z(!1),sessionStorage.setItem("userAnswers",JSON.stringify(P)),window.location.href="/gameover"},1500)}catch(e){console.error("提交答案發生錯誤：",e),I(!1),z(!1)}},Q=C.length?["A ".concat(null==(e=C[p-1])?void 0:e.option_A),"B ".concat(null==(t=C[p-1])?void 0:t.option_B),"C ".concat(null==(a=C[p-1])?void 0:a.option_C),"D ".concat(null==(r=C[p-1])?void 0:r.option_D)]:[],L=p/N*100;return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(c.A,{showMenu:!0,isMenuOpen:b,onToggleMenu:()=>{k(!b),document.body.style.overflow=b?"auto":"hidden"},enableNoteQLink:!0}),(0,n.jsx)(u.A,{isOpen:b,onClose:()=>{k(!1),document.body.style.overflow="auto"},onLogout:m.I}),(0,n.jsx)("main",{className:l().gameMain,children:(0,n.jsxs)("div",{className:l().questionContainer,children:[(0,n.jsxs)("h2",{className:l().questionNumber,children:["第 ",p," 題 / ",N," 題"]}),(0,n.jsx)("div",{className:l().progressBar,children:(0,n.jsx)("div",{className:l().progressFill,style:{width:"".concat(L,"%")}})}),(0,n.jsx)("p",{className:l().questionText,children:(null==(_=C[p-1])?void 0:_.title)||"題目載入中..."}),(0,n.jsxs)("div",{className:l().gameSection,children:[p>1&&(0,n.jsxs)("div",{className:l().backButton,onClick:()=>{g(e=>e-1),x(null)},children:[(0,n.jsx)(i.default,{src:"/img/Vector-9.png",alt:"Back",width:14,height:14}),(0,n.jsx)("span",{className:l().backText,children:"回上一題"})]}),(0,n.jsx)("div",{className:l().answerGrid,children:Q.map((e,t)=>(0,n.jsx)("div",{className:"".concat(l().answerOption," ").concat(h===t?l().selected:""),onClick:()=>(e=>{if(B)return;let t=C[p-1];if(!t)return;let a=["A","B","C","D"][e];if(O(!0),f(e=>[...e.filter(e=>e.topicId!==t.id),{topicId:t.id,selected:a}]),x(e),p===N){v(!0),O(!1);return}setTimeout(()=>{g(e=>e+1),x(null),O(!1)},300)})(t),style:{pointerEvents:B?"none":"auto"},children:e},t))}),p===N&&y&&(0,n.jsx)("div",{className:l().completeButtonContainer,children:(0,n.jsx)("button",{className:l().completeButton,onClick:F,children:"完成挑戰"})})]})]})}),A&&(0,n.jsx)("div",{className:l().decryptionOverlay,children:(0,n.jsx)("div",{className:l().decryptionContainer,children:(0,n.jsx)(d.A,{text:0===E?"正在整理您的答題記錄...":1===E?"正在分析答題結果...":2===E?"正在載入 AI 解析系統...":3===E?"正在優化解析系統...":4===E?"準備完成！查看您的挑戰結果...":"",onComplete:()=>{M&&E<3?D(e=>e+1):M&&3===E&&D(0)},speed:80,className:l().decryptionText},"decryption-text")})})]})}},3457:e=>{e.exports={gameMain:"GamePage_gameMain__meMNd",questionContainer:"GamePage_questionContainer__DmQy4",questionNumber:"GamePage_questionNumber__rnIiw",progressBar:"GamePage_progressBar__Lv5PF",progressFill:"GamePage_progressFill__QvidC",questionText:"GamePage_questionText__EOgz3",gameSection:"GamePage_gameSection__kIYJm",answerGrid:"GamePage_answerGrid__7SOKK",answerOption:"GamePage_answerOption__E_n6T",selected:"GamePage_selected__0Rxhc",backButton:"GamePage_backButton__h_EvR",backText:"GamePage_backText__ihz_B",completeButtonContainer:"GamePage_completeButtonContainer__v9E1J",completeButton:"GamePage_completeButton__weWDG",decryptionOverlay:"GamePage_decryptionOverlay__O_stu",decryptionContainer:"GamePage_decryptionContainer__2oOHQ",decryptionText:"GamePage_decryptionText__gT0eA"}},5353:(e,t,a)=>{Promise.resolve().then(a.bind(a,1857))}},e=>{e.O(0,[272,794,259,791,441,964,358],()=>e(e.s=5353)),_N_E=e.O()}]);